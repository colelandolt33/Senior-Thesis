(this["webpackJsonpmusic-discovery"]=this["webpackJsonpmusic-discovery"]||[]).push([[0],[,,,,,,,,,,,,,,function(e,t,a){e.exports=a(30)},,,,,function(e,t,a){},,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(11),i=a.n(r),o=(a(19),a(4)),c=a.n(o),l=a(3),u=a(7),m=a(6),p=a(2),h=a(1),d=a(5),y=(a(21),a(12)),v=a.n(y),k=(a(22),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={readInstructions:!1},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return!1===this.state.readInstructions?s.a.createElement("div",{className:"Login"},s.a.createElement("div",{className:"Intro"},s.a.createElement("p",null,"Welcome! This is an experiment where you can interact with your personalized Discover Weekly Playlist from Spotify in order to discover new songs and artists. We are interested in the process of music discovery, so your interactions will be recorded for research purposes. Please ensure before beginning the experiment that you are in a comfortable setting, free from significant distractions, and have plenty of time so that you can engage with each song recommendation."),s.a.createElement("p",null,"Note: You must be a Spotify Premium user in order to proceed."),s.a.createElement("button",{className:"Button",onClick:function(){e.setState({readInstructions:!0})}},"Read Instructions"))):s.a.createElement("div",{className:"Login"},s.a.createElement("div",{className:"Intro"},s.a.createElement("h2",null,"Your task is to explore each song from your Discover Weekly playlist and save those that you like and would listen to in the future to a new playlist!"),s.a.createElement("p",null,"Before proceeding to the experiment, please follow these simple instructions below")),s.a.createElement("div",{className:"Intro"},s.a.createElement("h2",null,"1) Open Spotify on your preferred device and play your favorite song!"),s.a.createElement("p",null,"Although you will be interacting with your music within this browser, the music itself will be playing through Spotify wherever you have it open."),s.a.createElement("p",null,"If you don't have Spotify's Desktop or Mobile Application downloaded, you can visit ",s.a.createElement("a",{href:"https://open.spotify.com/",target:"_blank"},"Spotify's Web Player")," and have the window open in the background during the experiment."),s.a.createElement("h2",null,"2) Make sure\xa0you\u2019re following your Discover Weekly playlist"),s.a.createElement("img",{src:"img/dw.jpg",className:"Image"}),s.a.createElement("p",{style:{alignSelf:"center"}},"(the heart symbol should be filled in)"),s.a.createElement("h2",null,"3) When you enter the experiment... "),s.a.createElement("p",null,"Your Discover Weekly Playlist will be displayed on the left-hand side, and a new playlist that you can add songs to will be displayed on the right-hand side."),s.a.createElement("p",null,"- You can listen to each track by clicking the\xa0\u25b6 / \u275a\u275a\xa0button."),s.a.createElement("img",{src:"img/play.jpg",className:"Image"}),s.a.createElement("p",null,"- You can save the song to your library by clicking the\xa0\u2661\xa0button."),s.a.createElement("img",{src:"img/like.jpg",className:"Image"}),s.a.createElement("p",null,"- You can search for other tracks by the artist by entering the artist\u2019s name into the search bar."),s.a.createElement("img",{src:"img/search.jpg",className:"Image"}),s.a.createElement("p",null,"- You can add songs that you like\xa0by pressing the + button."),s.a.createElement("img",{src:"img/add.jpg",className:"Image"}),s.a.createElement("p",null,"- Lastly, give your playlist a new name"),s.a.createElement("img",{src:"img/new_name.gif",className:"Image"}),s.a.createElement("p",null,"Once you've checked out every song on your Discover Weekly playlist, not to mention the others that you may have come across in searches, and have saved those that you liked to your newly named playlist, go ahead and ",s.a.createElement("strong",null,"save it to Spotify"),"!"),s.a.createElement("p",null,"**You must complete this step before exiting the experiment in order for your data to save and your playlist to be created**"),s.a.createElement("h2",{style:{alignSelf:"center"}},"You're all set to begin exploring!"),s.a.createElement("a",{href:"/start",style:{alignSelf:"center"}},s.a.createElement("button",{className:"Button",onClick:this.props.logIn},"Login with Spotify"))))}}]),t}(s.a.Component)),g=(a(23),function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return this.props.trackName?s.a.createElement("div",{className:"NowPlaying"},s.a.createElement("h2",null,"Now Playing:"),s.a.createElement("img",{src:this.props.trackImage,style:{width:150},alt:""}),s.a.createElement("h3",null,this.props.trackName," by ",this.props.trackArtist)):s.a.createElement("div",{className:"NowPlaying"},s.a.createElement("h2",null,"Now Playing:"),s.a.createElement("h3",null,"Please play a song in the Spotify Application on your preferred device before beginning."))}}]),t}(s.a.Component)),b=(a(24),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={term:""},a.handleTermChange=a.handleTermChange.bind(Object(h.a)(a)),a.search=a.search.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"search",value:function(){this.props.onSearch(this.state.term)}},{key:"handleTermChange",value:function(e){this.setState({term:e.target.value})}},{key:"render",value:function(){return s.a.createElement("div",{className:"SearchBar"},s.a.createElement("input",{onChange:this.handleTermChange,placeholder:"Search for an Artist"}),s.a.createElement("button",{onClick:this.search,className:"SearchButton"},"SEARCH"))}}]),t}(s.a.Component)),f=(a(25),a(26),a(27),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).state={saved:!1},a.saveTrack=a.saveTrack.bind(Object(h.a)(a)),a.unsaveTrack=a.unsaveTrack.bind(Object(h.a)(a)),a.playTrack=a.playTrack.bind(Object(h.a)(a)),a.pauseTrack=a.pauseTrack.bind(Object(h.a)(a)),a.checkNowPlaying=a.checkNowPlaying.bind(Object(h.a)(a)),a.addTrack=a.addTrack.bind(Object(h.a)(a)),a.removeTrack=a.removeTrack.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"playback",value:function(){return this.props.uri===this.props.nowPlaying.uri&&this.props.nowPlaying.isPlaying?s.a.createElement("button",{className:"Track-action",onClick:this.pauseTrack},"\u275a\u275a"):s.a.createElement("button",{className:"Track-action",onClick:this.playTrack},"\u25b6")}},{key:"heart",value:function(){return!0===this.state.saved?s.a.createElement("button",{className:"Track-action",onClick:this.unsaveTrack},"\u2665"):s.a.createElement("button",{className:"Track-action",onClick:this.saveTrack},"\u2661")}},{key:"renderAction",value:function(){return this.props.isRemoval?s.a.createElement("button",{className:"Track-action",onClick:this.removeTrack},"-"):s.a.createElement("button",{className:"Track-action",onClick:this.addTrack},"+")}},{key:"saveTrack",value:function(){this.props.onSave(this.props.id),this.setState({saved:!0})}},{key:"unsaveTrack",value:function(){this.props.onUnsave(this.props.id),this.setState({saved:!1})}},{key:"pauseTrack",value:function(){this.props.onPause()}},{key:"playTrack",value:function(){this.props.nowPlaying.uri===this.props.uri?this.props.onPlay():this.props.onPlay(this.props.uri)}},{key:"checkNowPlaying",value:function(){this.setState({isPlaying:this.props.nowPlaying.isPlaying})}},{key:"addTrack",value:function(){this.props.onAdd(this.props.track)}},{key:"removeTrack",value:function(){this.props.onRemove(this.props.track)}},{key:"render",value:function(){return s.a.createElement("div",{className:"Track"},s.a.createElement("div",{className:"Track-information"},s.a.createElement("h3",null,this.props.track.name),s.a.createElement("p",null,this.props.track.artist," | ",this.props.track.album)),this.playback(),this.heart(),this.renderAction())}}]),t}(s.a.Component)),w=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.tracks;return s.a.createElement("div",{className:"TrackList"},t.map((function(t){return s.a.createElement(f,{track:t,key:t.id,id:t.id,uri:t.uri,nowPlaying:e.props.nowPlaying,onSave:e.props.onSave,onUnsave:e.props.onUnsave,onPlay:e.props.onPlay,onPause:e.props.onPause,onAdd:e.props.onAdd,onRemove:e.props.onRemove,isRemoval:e.props.isRemoval})})))}}]),t}(s.a.Component),P=function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"SearchResults"},s.a.createElement("h2",null,"Search Results"),s.a.createElement(w,{tracks:this.props.tracks,nowPlaying:this.props.nowPlaying,onSave:this.props.onSave,onUnsave:this.props.onUnsave,onPlay:this.props.onPlay,onPause:this.props.onPause,onAdd:this.props.onAdd,isRemoval:!1}))}}]),t}(s.a.Component),E=(a(28),function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).handleNameChange=a.handleNameChange.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"handleNameChange",value:function(e){this.props.onNameChange(e.target.value)}},{key:"render",value:function(){return s.a.createElement("div",{className:"Playlist"},s.a.createElement("input",{defaultValue:this.props.playlistName,onChange:this.handleNameChange}),s.a.createElement(w,{tracks:this.props.playlistTracks,nowPlaying:this.props.nowPlaying,onSave:this.props.onSave,onUnsave:this.props.onUnsave,onPlay:this.props.onPlay,onPause:this.props.onPause,onRemove:this.props.onRemove,isRemoval:!0}),s.a.createElement("button",{className:"Playlist-save",onClick:this.props.onSavePlaylist},"SAVE TO SPOTIFY"))}}]),t}(s.a.Component)),T=(a(29),function(e){function t(){return Object(l.a)(this,t),Object(m.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"DiscoverWeekly"},s.a.createElement("h2",null,"Discover Weekly"),s.a.createElement(w,{tracks:this.props.tracks,nowPlaying:this.props.nowPlaying,onSave:this.props.onSave,onUnsave:this.props.onUnsave,onPlay:this.props.onPlay,onPause:this.props.onPause,onAdd:this.props.onAdd,isRemoval:!1}))}}]),t}(s.a.Component)),O=a(13),j=0,N=[],S=[],_=new v.a,C=!0,D="Are you sure you want to leave? Your playlist has not yet been saved.";window.onbeforeunload=function(e){if(C)return e||(e=window.event),e.cancelBubble=!0,e.returnValue=D,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()),D};var x=function(e){function t(e){var a;Object(l.a)(this,t);var n=(a=Object(m.a)(this,Object(p.a)(t).call(this,e))).getHashParams(),s=n.access_token,r=n.refresh_token;n.expires_in;return a.state={isLoggedIn:!!n.access_token,username:"",userID:"",nowPlaying:"",recommendations:[],searchResults:[],playlistName:"New Playlist",playlistTracks:[]},s&&(console.log("Access Token"),j=Date.now(),_.setAccessToken(s),setInterval((function(){var e=new XMLHttpRequest;e.open("POST","/refresh_token",!0),e.setRequestHeader("Content-type","application/json"),e.onload=function(){s=JSON.parse(e.response).access_token,_.setAccessToken(s)},e.send(JSON.stringify({refresh_token:r}))}),6e5),a.getUser(),a.getDiscoverWeekly(),Object(O.a)((function(){var e;return c.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.awrap(_.getMyCurrentPlaybackState());case 2:if(""!==(e=t.sent)){t.next=5;break}return t.abrupt("return");case 5:a.setState({nowPlaying:{isPlaying:e.is_playing,id:e.item.id,name:e.item.name,artist:e.item.artists[0].name,album:e.item.album.name,duration_ms:e.item.duration_ms,progress_ms:e.progress_ms,uri:e.item.uri,image:e.item.album.images[0].url}});case 6:case"end":return t.stop()}}))}),1e3)),a.getUser=a.getUser.bind(Object(h.a)(a)),a.getDiscoverWeekly=a.getDiscoverWeekly.bind(Object(h.a)(a)),a.search=a.search.bind(Object(h.a)(a)),a.beginPlayback=a.beginPlayback.bind(Object(h.a)(a)),a.endPlayback=a.endPlayback.bind(Object(h.a)(a)),a.saveTrack=a.saveTrack.bind(Object(h.a)(a)),a.unsaveTrack=a.unsaveTrack.bind(Object(h.a)(a)),a.addTrack=a.addTrack.bind(Object(h.a)(a)),a.removeTrack=a.removeTrack.bind(Object(h.a)(a)),a.updatePlaylistName=a.updatePlaylistName.bind(Object(h.a)(a)),a.savePlaylist=a.savePlaylist.bind(Object(h.a)(a)),a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"getHashParams",value:function(){for(var e,t={},a=/([^&;=]+)=?([^&;]*)/g,n=window.location.hash.substring(1);e=a.exec(n);)t[e[1]]=decodeURIComponent(e[2]);return t}},{key:"getUser",value:function(){var e;return c.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.awrap(_.getMe());case 2:e=t.sent,console.log("User information:",e),this.setState({username:e.display_name,userID:e.id});case 5:case"end":return t.stop()}}),null,this)}},{key:"getDiscoverWeekly",value:function(){var e,t,a;return c.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c.a.awrap(_.getUserPlaylists({limit:50}).then((function(e){return e.items.map((function(e){return{name:e.name,id:e.id}})).filter((function(e){return"Discover Weekly"===e.name}))}),(function(e){console.error(e)})));case 3:return e=n.sent,n.next=6,c.a.awrap(_.getPlaylistTracks(this.state.username,e[0].id).then((function(e){return e.items.map((function(e){return{id:e.track.id,name:e.track.name.substring(0,40),artist:e.track.artists[0].name.substring(0,70),album:e.track.album.name.substring(0,70),duration_ms:e.track.duration_ms,uri:e.track.uri}}))}),(function(e){console.error(e)})));case 6:return t=n.sent,this.setState({recommendations:t}),n.next=10,c.a.awrap(_.getAudioFeaturesForTracks(t.map((function(e){return e.id}))).then((function(e){return e.audio_features?e.audio_features.map((function(e){return{id:e.id,danceability:e.danceability,energy:e.energy,key:e.key,loudness:e.loudness,mode:e.mode,speechiness:e.speechiness,acousticness:e.acousticness,instrumentalness:e.instrumentalness,liveness:e.liveness,valence:e.valence,tempo:e.tempo,time_signature:e.time_signature}})):[]})));case 10:a=n.sent,N=t.map((function(e,t){if(e.id===a[t].id)return Object.assign({},e,a[t])})),console.log("Discover Weekly:",N),n.next=18;break;case 15:n.prev=15,n.t0=n.catch(0),console.error(n.t0);case 18:case"end":return n.stop()}}),null,this,[[0,15]])}},{key:"search",value:function(e){var t;return c.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,c.a.awrap(_.searchTracks("artist:"+e).then((function(e){return e.tracks?e.tracks.items.map((function(e){return{id:e.id,name:e.name.substring(0,40),artist:e.artists[0].name.substring(0,70),album:e.album.name.substring(0,70),uri:e.uri}})):[]}),(function(e){console.error(e)})));case 2:t=a.sent,console.log("Search Results:",t),this.setState({searchResults:t}),S.push({type:"search",time_stamp:Date.now()-j,artist:e});case 6:case"end":return a.stop()}}),null,this)}},{key:"beginPlayback",value:function(e){var t;return c.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=this.state.nowPlaying,!e){a.next=8;break}return t&&S.push({type:"play",time_stamp:Date.now()-j-t.progress_ms,time_end:Date.now()-j,id:t.id,name:t.name,artist:t.artist,album:t.album,duration_ms:t.duration_ms,progress_ms:t.progress_ms}),a.next=5,c.a.awrap(_.play({uris:[e]},(function(e,t){console.log(e),console.log(t)})));case 5:S.push({type:"play",time_stamp:Date.now()-j,id:t.id,name:t.name,artist:t.artist,album:t.album,duration_ms:t.duration_ms,progress_ms:t.progress_ms}),a.next=10;break;case 8:return a.next=10,c.a.awrap(_.play({},(function(e,t){console.log(e),console.log(t)})));case 10:case"end":return a.stop()}}),null,this)}},{key:"endPlayback",value:function(e){this.state.nowPlaying!=={}&&_.pause({},(function(e,t){console.log(e),console.log(t)}))}},{key:"saveTrack",value:function(e){_.addToMySavedTracks([e]);var t=this.state.recommendations.filter((function(t){return t.id===e})),a=this.state.searchResults.filter((function(t){return t.id===e})),n=t===[]?a:t;console.log(n),S.push({type:"save",time_stamp:Date.now()-j,id:e,name:n.name,artist:n.artist,album:n.album,duration_ms:n.duration_ms})}},{key:"unsaveTrack",value:function(e){_.removeFromMySavedTracks([e]);var t=this.state.recommendations.filter((function(t){return t.id===e})),a=this.state.searchResults.filter((function(t){return t.id===e})),n=t===[]?a:t;console.log(n),S.push({type:"unsave",time_stamp:Date.now()-j,id:e,name:n.name,artist:n.artist,album:n.album,duration_ms:n.duration_ms})}},{key:"addTrack",value:function(e){var t=this.state.playlistTracks;t.find((function(t){return t.id===e.id}))||(console.log(e),S.push({type:"add",time_stamp:Date.now()-j,id:e.id,name:e.name,artist:e.artist,album:e.album,duration_ms:e.duration_ms}),t.push(e),this.setState({playlistTracks:t}))}},{key:"removeTrack",value:function(e){var t=this.state.playlistTracks;t=t.filter((function(t){return t.id!==e.id})),console.log(e),S.push({type:"remove",time_stamp:Date.now()-j,id:e.id,name:e.name,artist:e.artist,album:e.album,duration_ms:e.duration_ms}),this.setState({playlistTracks:t})}},{key:"updatePlaylistName",value:function(e){this.setState({playlistName:e})}},{key:"savePlaylist",value:function(e){var t,a,n,s,r;return c.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if((t=this.state.nowPlaying)&&S.push({type:"play",time_stamp:Date.now()-j-t.progress_ms,time_end:Date.now()-j,id:t.id,name:t.name,artist:t.artist,album:t.album,duration_ms:t.duration_ms,progress_ms:t.progress_ms}),a=this.state.playlistTracks.map((function(e){return e.uri})),e&&a){i.next=5;break}return i.abrupt("return");case 5:return i.next=7,c.a.awrap(_.createPlaylist(this.state.userID,{name:this.state.playlistName}).then((function(e){return e.id})));case 7:n=i.sent,console.log(S),console.log(N),(s=new XMLHttpRequest).open("POST","/save_data",!0),s.setRequestHeader("Content-type","application/json"),s.send(JSON.stringify({id:this.state.userID,data:S,type:"timeline"})),(r=new XMLHttpRequest).open("POST","/save_data",!0),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify({id:this.state.userID,data:N,type:"recommendations"})),_.addTracksToPlaylist(this.state.userID,n,a),C=!1,alert("You have successfully created a new playlist called "+this.state.playlistName+". You may now exit the experiment. Feel free to revisit next week once your Discover Weeekly playlist has reset!");case 21:case"end":return i.stop()}}),null,this)}},{key:"render",value:function(){return!1===this.state.isLoggedIn?s.a.createElement("div",null,s.a.createElement("h1",null,"Music Discovery with ",s.a.createElement("span",{className:"highlight"},"Spotify")),s.a.createElement("div",{className:"App"},s.a.createElement(k,{logIn:function(){C=!1}}))):s.a.createElement("div",null,s.a.createElement("h1",null,"Music Discovery with ",s.a.createElement("span",{className:"highlight"},"Spotify")),s.a.createElement("h2",{className:"welcome"},"Welcome, ",this.state.username,"!"),s.a.createElement("div",{className:"App"},s.a.createElement("div",{className:"App-top"},s.a.createElement(g,{currentTrack:this.getDiscoverWeekly,trackName:this.state.nowPlaying.name,trackArtist:this.state.nowPlaying.artist,trackImage:this.state.nowPlaying.image}),s.a.createElement(b,{onSearch:this.search})),s.a.createElement("div",{className:"App-playlist"},s.a.createElement(T,{tracks:this.state.recommendations,nowPlaying:this.state.nowPlaying,onSave:this.saveTrack,onUnsave:this.unsaveTrack,onAdd:this.addTrack,onPlay:this.beginPlayback,onPause:this.endPlayback}),s.a.createElement(P,{tracks:this.state.searchResults,nowPlaying:this.state.nowPlaying,onSave:this.saveTrack,onUnsave:this.unsaveTrack,onChange:this.updateSearchResults,onAdd:this.addTrack,onPlay:this.beginPlayback,onPause:this.endPlayback}),s.a.createElement(E,{playlistName:this.state.playlistName,playlistTracks:this.state.playlistTracks,nowPlaying:this.state.nowPlaying,onSave:this.saveTrack,onUnsave:this.unsaveTrack,onRemove:this.removeTrack,onNameChange:this.updatePlaylistName,onSavePlaylist:this.savePlaylist,onPlay:this.beginPlayback,onPause:this.endPlayback}))))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(x,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[14,1,2]]]);
//# sourceMappingURL=main.9f7549a1.chunk.js.map